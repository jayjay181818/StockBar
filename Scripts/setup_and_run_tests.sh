#!/bin/bash

# Stockbar Unit Test Setup & Execution Script
# This script helps set up and run the Phase 5 unit tests

echo "=========================================="
echo "Stockbar v2.3.0 - Unit Test Setup"
echo "=========================================="
echo ""

PROJECT_DIR="/Users/josh/Downloads/Stockbar Claude/Stockbar"
cd "$PROJECT_DIR"

echo "ðŸ“‹ Test files available:"
ls -1 StockbarTests/*Tests.swift 2>/dev/null | grep -E "RiskMetrics|TechnicalIndicator|MenuBar|PortfolioAnalytics" || echo "  (test files not found)"
echo ""

echo "=========================================="
echo "Setup Instructions"
echo "=========================================="
echo ""
echo "The test files have been created but need a test target in Xcode:"
echo ""
echo "1ï¸âƒ£  Open Xcode:"
echo "   open \"$PROJECT_DIR/Stockbar.xcodeproj\""
echo ""
echo "2ï¸âƒ£  Create Unit Test Target:"
echo "   â€¢ File â†’ New â†’ Target..."
echo "   â€¢ Select 'macOS' tab"
echo "   â€¢ Choose 'Unit Testing Bundle'"
echo "   â€¢ Click 'Next'"
echo "   â€¢ Product Name: 'StockbarTests'"
echo "   â€¢ Team: (your team or 'None')"
echo "   â€¢ Target to be Tested: 'Stockbar'"
echo "   â€¢ Click 'Finish'"
echo ""
echo "3ï¸âƒ£  Add existing test files to target:"
echo "   â€¢ In Project Navigator, locate 'StockbarTests' folder"
echo "   â€¢ Select these 4 files (âŒ˜-click to select multiple):"
echo "     - RiskMetricsServiceTests.swift"
echo "     - TechnicalIndicatorServiceTests.swift"
echo "     - MenuBarFormattingServiceTests.swift"
echo "     - PortfolioAnalyticsServicesTests.swift"
echo "   â€¢ Open File Inspector (âŒ¥âŒ˜1)"
echo "   â€¢ Under 'Target Membership', check 'StockbarTests'"
echo ""
echo "   Alternatively, you can:"
echo "   â€¢ Delete the auto-generated 'StockbarTests.swift' file"
echo "   â€¢ Right-click 'StockbarTests' group â†’ Add Files to 'Stockbar'..."
echo "   â€¢ Navigate to StockbarTests folder"
echo "   â€¢ Select the 4 test files"
echo "   â€¢ Ensure 'StockbarTests' target is checked"
echo "   â€¢ Click 'Add'"
echo ""
echo "4ï¸âƒ£  Run tests:"
echo "   â€¢ Press âŒ˜U (or Product â†’ Test)"
echo "   â€¢ View results in Test Navigator (âŒ˜6)"
echo ""
echo "=========================================="
echo "Quick Start"
echo "=========================================="
echo ""
echo "Run this command to open Xcode:"
echo ""
echo "  open \"$PROJECT_DIR/Stockbar.xcodeproj\""
echo ""
echo "Then follow steps 2-4 above."
echo ""
echo "=========================================="
echo "Test Coverage"
echo "=========================================="
echo ""
echo "âœ… RiskMetricsServiceTests (17 tests)"
echo "   â€¢ VaR, Sharpe, Sortino, Beta, Max Drawdown"
echo ""
echo "âœ… TechnicalIndicatorServiceTests (19 tests)"
echo "   â€¢ SMA, EMA, RSI, MACD, Bollinger Bands"
echo ""
echo "âœ… MenuBarFormattingServiceTests (23 tests)"
echo "   â€¢ All display modes, templates, formatting"
echo ""
echo "âœ… PortfolioAnalyticsServicesTests (21 tests)"
echo "   â€¢ Correlation matrix, sector analysis"
echo ""
echo "ðŸ“Š Total: 80+ comprehensive unit tests"
echo ""
echo "=========================================="
echo "Troubleshooting"
echo "=========================================="
echo ""
echo "If tests don't appear after adding files:"
echo "  â€¢ Clean build folder: â‡§âŒ˜K"
echo "  â€¢ Rebuild: âŒ˜B"
echo "  â€¢ Check Target Membership in File Inspector"
echo ""
echo "If you get 'No such module Stockbar' errors:"
echo "  â€¢ Ensure @testable import Stockbar is present"
echo "  â€¢ Verify 'Stockbar' target is set as dependency"
echo ""
echo "Expected Results:"
echo "  â€¢ Green checkmarks (âœ“) = Pass"
echo "  â€¢ Red X marks (âœ—) = Fail"
echo "  â€¢ Target: >80% pass rate"
echo ""
echo "Good luck! ðŸš€"
echo ""
